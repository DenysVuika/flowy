var flowy=function(){"use strict";!function(t,e){void 0===e&&(e={});var i=e.insertAt;if(t&&"undefined"!=typeof document){var l=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&l.firstChild?l.insertBefore(n,l.firstChild):l.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}(".dragging {\n  z-index: 111 !important;\n}\n.block {\n  position: absolute;\n  z-index: 9;\n}\n.indicator {\n  width: 12px;\n  height: 12px;\n  border-radius: 60px;\n  background-color: #217ce8;\n  margin-top: -5px;\n  opacity: 1;\n  transition: all 0.3s cubic-bezier(0.05, 0.03, 0.35, 1);\n  transform: scale(1);\n  position: absolute;\n  z-index: 2;\n}\n.invisible {\n  opacity: 0 !important;\n  transform: scale(0);\n}\n.indicator:after {\n  content: '';\n  display: block;\n  width: 12px;\n  height: 12px;\n  background-color: #217ce8;\n  transform: scale(1.7);\n  opacity: 0.2;\n  border-radius: 60px;\n}\n.arrowblock {\n  position: absolute;\n  width: 110%;\n  pointer-events: none;\n}\n.arrowblock svg {\n  width: 110%;\n}\n");const t=(e,i,l,n,o,r)=>{function s(t){n(t)}i||(i=function(){}),l||(l=function(){}),n||(n=function(){}),o||(o=20),r||(r=80),$(document).ready(()=>{let n=[],f=[];const d=e;let a=!1;const p=o,c=r;let h,u,w,g,x=0,v=0,m=!1,b=!1,k=-1;function y(){x=n.map(t=>t.x);const t=n.map(t=>t.width),e=x.map((e,i)=>e-t[i]/2);if((x=Math.min.apply(Math,e))<d.offset().left){b=!0;const t=n.map(t=>t.id);for(let e=0;e<n.length;e++)if($(".blockid[value="+n.filter(i=>i.id==t[e])[0].id+"]").parent().css("left",n.filter(i=>i.id==t[e])[0].x-n.filter(i=>i.id==t[e])[0].width/2-x+20),-1!=n.filter(i=>i.id==t[e])[0].parent){const i=n.filter(i=>i.id==t[e])[0];i.x-n.filter(i=>i.id==n.filter(i=>i.id==t[e])[0].parent)[0].x<0?$(".arrowid[value="+t[e]+"]").parent().css("left",i.x-x+20-5+"px"):$(".arrowid[value="+t[e]+"]").parent().css("left",n.filter(i=>i.id==n.filter(i=>i.id==t[e])[0].parent)[0].x-20-x+20+"px")}for(let t=0;t<n.length;t++)n[t].x=$(".blockid[value="+n[t].id+"]").parent().offset().left+d.offset().left-$(".blockid[value="+n[t].id+"]").parent().innerWidth()/2-40;v=x}}function C(){const t=n.map(t=>t.parent);for(let e=0;e<t.length;e++){-1==t[e]&&e++;let i=0,l=0;for(let l=0;l<n.filter(i=>i.parent==t[e]).length;l++){const o=n.filter(i=>i.parent==t[e])[l];0==n.filter(t=>t.parent==o.id).length&&(o.childwidth=0),o.childwidth>o.width?l==n.filter(i=>i.parent==t[e]).length-1?i+=o.childwidth:i+=o.childwidth+p:l==n.filter(i=>i.parent==t[e]).length-1?i+=o.width:i+=o.width+p}-1!=t[e]&&(n.filter(i=>i.id==t[e])[0].childwidth=i);for(let o=0;o<n.filter(i=>i.parent==t[e]).length;o++){const r=n.filter(i=>i.parent==t[e])[o];$(".blockid[value="+r.id+"]").parent().css("top",n.filter(i=>i.id==t[e]).y+c+"px"),n.filter(i=>i.id==t[e]).y=n.filter(i=>i.id==t[e]).y+c,r.childwidth>r.width?($(".blockid[value="+r.id+"]").parent().css("left",n.filter(i=>i.id==t[e])[0].x-i/2+l+r.childwidth/2-r.width/2-d.offset().left+"px"),r.x=n.filter(i=>i.id==t[e])[0].x-i/2+l+r.childwidth/2,l+=r.childwidth+p):($(".blockid[value="+r.id+"]").parent().css("left",n.filter(i=>i.id==t[e])[0].x-i/2+l-d.offset().left+"px"),r.x=n.filter(i=>i.id==t[e])[0].x-i/2+l+r.width/2,l+=r.width+p);const s=n.filter(t=>t.id==r.id)[0],f=s.x-n.filter(t=>t.id==r.parent)[0].x+20,a=s.y-s.height/2-(n.filter(t=>t.id==r.parent)[0].y+n.filter(t=>t.id==r.parent)[0].height/2);$(".arrowid[value="+r.id+"]").parent().css("top",n.filter(t=>t.id==r.parent)[0].y+n.filter(t=>t.id==r.parent)[0].height/2-d.offset().top+"px"),f<0?($(".arrowid[value="+r.id+"]").parent().css("left",s.x-5-d.offset().left+"px"),$(".arrowid[value="+r.id+"]").parent().html('<input type="hidden" class="arrowid" value="'+r.id+'"><svg preserveaspectratio="none" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M'+(n.filter(t=>t.id==r.parent)[0].x-s.x+5)+" 0L"+(n.filter(t=>t.id==r.parent)[0].x-s.x+5)+" "+c/2+"L5 "+c/2+"L5 "+a+'" stroke="#C5CCD0" stroke-width="2px"/><path d="M0 '+(a-5)+"H10L5 "+a+"L0 "+(a-5)+'Z" fill="#C5CCD0"/></svg>')):($(".arrowid[value="+r.id+"]").parent().css("left",n.filter(t=>t.id==r.parent)[0].x-20-d.offset().left+"px"),$(".arrowid[value="+r.id+"]").parent().html('<input type="hidden" class="arrowid" value="'+r.id+'"><svg preserveaspectratio="none" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 0L20 '+c/2+"L"+f+" "+c/2+"L"+f+" "+a+'" stroke="#C5CCD0" stroke-width="2px"/><path d="M'+(f-5)+" "+(a-5)+"H"+(f+5)+"L"+f+" "+a+"L"+(f-5)+" "+(a-5)+'Z" fill="#C5CCD0"/></svg>'))}}}d.append("<div class='indicator invisible'></div>"),t.output=function(){const t=[];if(n.length>0){for(let e=0;e<n.length;e++)t.push({id:n[e].id,parent:n[e].parent,data:[]}),$(".blockid[value="+n[e].id+"]").parent().children("input").each((function(){const i=$(this).attr("name"),l=$(this).val();t[e].data.push({name:i,value:l})}));return t}},t.deleteBlocks=function(){n=[],d.html("<div class='indicator invisible'></div>")},$(document).on("mousedown",".create-flowy",(function(t){if(1===t.which){g=t.currentTarget;const l=++k;$(this).clone().addClass("block").append(`<input type='hidden' name='blockid' class='blockid' value='${l}'>`).removeClass("create-flowy").appendTo("body"),g.classList.add("dragnow"),h=$(`.blockid[value='${l}']`).parent(),e=$(this),i(e),h.addClass("dragging"),a=!0,u=t.clientX-$(this).offset().left,w=t.clientY-$(this).offset().top,h.css("left",t.clientX-u+"px"),h.css("top",t.clientY-w+"px")}var e})),$(document).on("mouseup",t=>{if(1===t.which&&(a||m)){l(),$(".indicator").hasClass("invisible")||$(".indicator").addClass("invisible"),a&&(g.classList.remove("dragnow"),h.removeClass("dragging"));const t=parseInt(h.children(".blockid").val());if(0==t&&m){h.removeClass("dragging"),m=!1;for(let e=0;e<f.length;e++)if(f[e].id!=t){const t=$(`.blockid[value='${f[e].id}']`),i=$(`.arrowid[value='${f[e].id}']`);t.parent().css("left",t.parent().offset().left-d.offset().left+d.scrollLeft()),t.parent().css("top",t.parent().offset().top-d.offset().top+d.scrollTop()),i.parent().css("left",i.parent().offset().left-d.offset().left+d.scrollLeft()),i.parent().css("top",i.parent().offset().top-d.offset().top+d.scrollTop()+"px"),t.parent().appendTo(d),i.parent().appendTo(d),f[e].x=t.parent().offset().left+t.innerWidth()/2+d.scrollLeft(),f[e].y=t.parent().offset().top+t.parent().innerHeight()/2+d.scrollTop()}f.filter(t=>0==t.id)[0].x=h.offset().left+h.innerWidth()/2,f.filter(t=>0==t.id)[0].y=h.offset().top+h.innerHeight()/2,n=$.merge(n,f),f=[]}else if(a&&0==n.length&&h.offset().top>d.offset().top&&h.offset().left>d.offset().left)s(h),a=!1,h.css("top",h.offset().top-d.offset().top+d.scrollTop()+"px"),h.css("left",h.offset().left-d.offset().left+d.scrollLeft()+"px"),h.appendTo(d),n.push({parent:-1,childwidth:0,id:t,x:h.offset().left+h.innerWidth()/2+d.scrollLeft(),y:h.offset().top+h.innerHeight()/2+d.scrollTop(),width:h.innerWidth(),height:h.innerHeight()});else if(a&&0==n.length)h.remove();else if(a||m){const t=h.offset().left+h.innerWidth()/2+d.scrollLeft(),e=h.offset().top+d.scrollTop(),i=n.map(t=>t.id);for(let l=0;l<n.length;l++){const o=n.filter(t=>t.id==i[l])[0],r=n.filter(t=>t.parent==i[l]);if(t>=o.x-o.width/2-p&&t<=o.x+o.width/2+p&&e>=o.y-o.height/2&&e<=o.y+o.height){a=!1,m||(s(h),h.appendTo(d));let t=0,e=0;for(let e=0;e<r.length;e++){const i=r[e];i.childwidth>i.width?t+=i.childwidth+p:t+=i.width+p}t+=h.innerWidth();for(let i=0;i<r.length;i++){const l=r[i],n=$(`.blockid[value='${l.id}']`);l.childwidth>l.width?(n.parent().css("left",o.x-t/2+e+l.childwidth/2-l.width/2+"px"),l.x=r[0].x-t/2+e+l.childwidth/2,e+=l.childwidth+p):(n.parent().css("left",o.x-t/2+e+"px"),l.x=r[0].x-t/2+e+l.width/2,e+=l.width+p)}h.css("left",o.x-t/2+e-d.offset().left+d.scrollLeft()+"px"),h.css("top",o.y+o.height/2+c-d.offset().top+"px");const u=parseInt(h.children(".blockid").val()),w=f.filter(t=>t.id==u)[0];if(m){w.x=h.offset().left+h.innerWidth()/2+d.scrollLeft()+d.scrollLeft(),w.y=h.offset().top+h.innerHeight()/2+d.scrollTop(),w.parent=i[l];for(let t=0;t<f.length;t++)if(f[t].id!=u){const e=$(`.blockid[value='${f[t].id}]`),i=$(`.arrowid[value='${f[t].id}']`);e.parent().css("left",e.parent().offset().left-d.offset().left+d.scrollLeft()),e.parent().css("top",e.parent().offset().top-d.offset().top+d.scrollTop()),i.parent().css("left",i.parent().offset().left-d.offset().left+d.scrollLeft()+20),i.parent().css("top",i.parent().offset().top-d.offset().top+d.scrollTop()),e.parent().appendTo(d),i.parent().appendTo(d),f[t].x=e.parent().offset().left+e.innerWidth()/2+d.scrollLeft(),f[t].y=e.parent().offset().top+e.parent().innerHeight()/2+d.scrollTop()}n=$.merge(n,f),f=[]}else n.push({childwidth:0,parent:i[l],id:u,x:h.offset().left+h.innerWidth()/2+d.scrollLeft(),y:h.offset().top+h.innerHeight()/2+d.scrollTop(),width:h.innerWidth(),height:h.innerHeight()});const g=n.filter(t=>t.id==u)[0],x=$(`.arrowid[value='${u}']`),v=g.x-o.x+20,b=g.y-g.height/2-(n.filter(t=>t.parent==i[l])[0].y+n.filter(t=>t.parent==i[l])[0].height/2)+d.scrollTop();if(v<0?(h.after('<div class="arrowblock"><input type="hidden" class="arrowid" value="'+u+'"><svg preserveaspectratio="none" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M'+(o.x-g.x+5)+" 0L"+(o.x-g.x+5)+" "+c/2+"L5 "+c/2+"L5 "+b+'" stroke="#C5CCD0" stroke-width="2px"/><path d="M0 '+(b-5)+"H10L5 "+b+"L0 "+(b-5)+'Z" fill="#C5CCD0"/></svg></div>'),x.parent().css("left",g.x-5-d.offset().left+d.scrollLeft()+"px")):(h.after('<div class="arrowblock"><input type="hidden" class="arrowid" value="'+u+'"><svg preserveaspectratio="none" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 0L20 '+c/2+"L"+v+" "+c/2+"L"+v+" "+b+'" stroke="#C5CCD0" stroke-width="2px"/><path d="M'+(v-5)+" "+(b-5)+"H"+(v+5)+"L"+v+" "+b+"L"+(v-5)+" "+(b-5)+'Z" fill="#C5CCD0"/></svg></div>'),x.parent().css("left",o.x-20-d.offset().left+d.scrollLeft()+"px")),x.parent().css("top",o.y+o.height/2+"px"),-1!=o.parent){let e=!1,o=i[l];for(;!e;)if(-1==n.filter(t=>t.id==o)[0].parent)e=!0;else{let t=0;for(let e=0;e<n.filter(t=>t.parent==o).length;e++){const i=n.filter(t=>t.parent==o)[e];i.childwidth>i.width?e==n.filter(t=>t.parent==o).length-1?t+=i.childwidth:t+=i.childwidth+p:e==n.filter(t=>t.parent==o).length-1?t+=i.width:t+=i.width+p}n.filter(t=>t.id==o)[0].childwidth=t,o=n.filter(t=>t.id==o)[0].parent}n.filter(t=>t.id==o)[0].childwidth=t}m&&(m=!1,h.removeClass("dragging")),C(),y();break}l==n.length-1&&(m&&(m=!1,f=[]),a=!1,h.remove())}}}}),$(document).on("mousedown",".block",()=>{$(document).on("mouseup mousemove",".block",(function t(e){if("mouseup"!==e.type&&1===e.which&&!a&&!m){m=!0,(h=$(this)).addClass("dragging"),u=e.clientX-$(this).offset().left,w=e.clientY-$(this).offset().top;const t=parseInt($(this).children(".blockid").val());h=$(this),f.push(n.filter(e=>e.id==t)[0]),n=$.grep(n,e=>e.id!=t),$(".arrowid[value="+t+"]").parent().remove();let i=n.filter(e=>e.parent==t),l=!1,o=[];const r=[];for(;!l;){for(let t=0;t<i.length;t++)f.push(n.filter(e=>e.id==i[t].id)[0]),$(".blockid[value="+i[t].id+"]").parent().css("left",$(".blockid[value="+i[t].id+"]").parent().offset().left-h.offset().left),$(".blockid[value="+i[t].id+"]").parent().css("top",$(".blockid[value="+i[t].id+"]").parent().offset().top-h.offset().top),$(".arrowid[value="+i[t].id+"]").parent().css("left",$(".arrowid[value="+i[t].id+"]").parent().offset().left-h.offset().left),$(".arrowid[value="+i[t].id+"]").parent().css("top",$(".arrowid[value="+i[t].id+"]").parent().offset().top-h.offset().top),$(".blockid[value="+i[t].id+"]").parent().appendTo(h),$(".arrowid[value="+i[t].id+"]").parent().appendTo(h),o.push(i[t].id),r.push(i[t].id);0==o.length?l=!0:(i=n.filter(t=>o.includes(t.parent)),o=[])}for(let e=0;e<n.filter(e=>e.parent==t).length;e++){const i=n.filter(e=>e.parent==t)[e];n=$.grep(n,t=>t.id!=i)}for(let t=0;t<r.length;t++){const e=r[t];n=$.grep(n,t=>t.id!=e)}n.length>1&&C(),b&&function(){if(v<d.offset().left){b=!1;const t=n.map(t=>t.id);for(let e=0;e<n.length;e++){const i=n.filter(i=>i.id==t[e])[0];if($(".blockid[value="+i.id+"]").parent().css("left",i.x-i.width/2-v-20),i.x=$(".blockid[value="+i.id+"]").parent().offset().left+i.width/2,-1!=i.parent){const l=i,o=l.x-n.filter(t=>t.id==i.parent)[0].x,r=$(".arrowid[value="+t[e]+"]");o<0?r.parent().css("left",l.x-5-d.offset().left+"px"):r.parent().css("left",n.filter(t=>t.id==i.parent)[0].x-20-d.offset().left+"px")}}v=0}}()}$(document).off("mouseup mousemove",t)}))}),$(document).on("mousemove",t=>{if(a?(h.css("left",t.clientX-u+"px"),h.css("top",t.clientY-w+"px")):m&&(h.css("left",t.clientX-u-d.offset().left+d.scrollLeft()+"px"),h.css("top",t.clientY-w-d.offset().top+d.scrollTop()+"px"),f.filter(t=>t.id==parseInt(h.children(".blockid").val())).x=h.offset().left+h.innerWidth()/2+d.scrollLeft(),f.filter(t=>t.id==parseInt(h.children(".blockid").val())).y=h.offset().left+h.innerHeight()/2+d.scrollTop()),a||m){const t=h.offset().left+h.innerWidth()/2+d.scrollLeft(),e=h.offset().top+d.scrollTop(),i=n.map(t=>t.id);for(let l=0;l<n.length;l++){if(t>=n.filter(t=>t.id==i[l])[0].x-n.filter(t=>t.id==i[l])[0].width/2-p&&t<=n.filter(t=>t.id==i[l])[0].x+n.filter(t=>t.id==i[l])[0].width/2+p&&e>=n.filter(t=>t.id==i[l])[0].y-n.filter(t=>t.id==i[l])[0].height/2&&e<=n.filter(t=>t.id==i[l])[0].y+n.filter(t=>t.id==i[l])[0].height){$(".indicator").appendTo($(".blockid[value="+i[l]+"]").parent()),$(".indicator").css("left",$(".blockid[value="+i[l]+"]").parent().innerWidth()/2-5+"px"),$(".indicator").css("top",$(".blockid[value="+i[l]+"]").parent().innerHeight()+"px"),$(".indicator").removeClass("invisible");break}l==n.length-1&&($(".indicator").hasClass("invisible")||$(".indicator").addClass("invisible"))}}})})};return t}();
